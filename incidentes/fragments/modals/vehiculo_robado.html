<!-- Modal: Registro de Vehículo Robado -->
<div class="modal fade" id="modal-vehiculo-robado" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title mb-0 text-left">Registro de Vehículos Robados</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12 m-0">
                        <div class="panel panel-filled panel-c-accent">
                            <div class="panel-heading">
                                <div class="panel-tools">
                                    <a class="panel-toggle"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <h5 class="panel-toggle" style="cursor:pointer;">INFORMACIÓN DEL VEHICULO</h5>
                            </div>
                            <div class="panel-body">
                                <div class="col-lg-3">
                                    <label>Placa</label>
                                    <div class=form-group>
                                        <input id="txtname-vehiculo" type="text" class="form-control"
                                            placeholder="e.g ABC-123">
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <label>Tipo de Vehiculo</label>
                                    <div class=form-group>
                                        <select id="txttipo_cuerpo-vehiculo" class="form-control">
                                            <option value="" disabled selected>Seleccione tipo de vehiculo</option>
                                            <option value=3>Auto</option>
                                            <option value=4>Motocicleta</option>
                                            <option value=6>Bus</option>
                                            <option value=8>Camion</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <label>Marca</label>
                                    <div class=form-group>
                                        <input id="txtmarca-vehiculo" type="text" class="form-control" placeholder="e.g Toyota">
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <label>Modelo</label>
                                    <div class=form-group>
                                        <input id="txtmodelo-vehiculo" type="text" class="form-control" placeholder="e.g Corolla">
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <label>Color</label>
                                    <div class=form-group>
                                        <input id="txtcolor-vehiculo" type="text" class="form-control"
                                            placeholder="e.g Gris metálico">
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <label>Número de Identificación</label>
                                    <div class=form-group>
                                        <input id="txtnum_ident-vehiculo" type="text" class="form-control"
                                            placeholder="e.g 1ZWBM7EX17KXXXXXXX">
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <label>Año del Carro</label>
                                    <div class=form-group>
                                        <input id="txtanio_carro-vehiculo" type="integer" class="form-control"
                                            placeholder="e.g 2018">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-filled panel-c-accent">
                            <div class="panel-heading">
                                <div class="panel-tools">
                                    <a class="panel-toggle"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <h5 class="panel-toggle" style="cursor:pointer;">INFORMACIÓN DEL ROBO</h5>
                            </div>
                            <div class="panel-body">
                                <div class="col-lg-3">
                                    <label>Fecha de Robo</label>
                                    <div class=form-group>
                                        <input id="txtfecha_robo-vehiculo" type="date" class="form-control"
                                            placeholder="Selecciona fecha">
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <label>Descripción</label>
                                    <div class=form-group>
                                        <textarea id="txtdescripcion-vehiculo" class="form-control" placeholder="Ingrese información complementaria del caso" rows="4"
                                        style="resize: none;"></textarea>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="panel panel-filled panel-c-accent">
                            <div class="panel-heading">
                                <div class="panel-tools">
                                    <a class="panel-toggle"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <h5 class="panel-toggle" style="cursor:pointer;">INFORMACIÓN DEL PROPIETARIO</h5>
                            </div>
                            <div class="panel-body">
                                <div class="col-lg-12">
                                    <label>Nombre Completo</label>
                                    <div class=form-group>
                                        <input id="txtnombrecompleto-vehiculo" type="text" class="form-control" placeholder="Ingreso Nombre y Apellidos">
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <label>Telefono/Celular</label>
                                    <div class=form-group>
                                        <input id="txtcontacto-vehiculo" type="integer" class="form-control" placeholder="000 000 000">
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class=form-group>
                                        <label>Tipo de documento</label>
                                        <select id="txtident_tipo-vehiculo" class="form-control">
                                            <option value="" disabled selected>Seleccione tipo de doc</option>
                                            <option value="DNI" selected>DNI</option>
                                            <option value="CE">Carnet Extranjeria</option>
                                            <option value="PA">Pasaporte</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class=form-group>
                                        <label>Número de documento</label>
                                        <input id="txtident_nro-vehiculo" type="text" class="form-control" placeholder="00000000">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-rounded" data-dismiss="modal">Cerrar</button>
                <button id="btnSendNewVehiculo" type="button" class="btn btn-accent btn-rounded">Guardar Vehículo</button>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    const id_lista = 1;

    function getvaluesVehiculo() {
        return {
            id_lista: id_lista,
            name: $("#txtname-vehiculo").val(),
            marca: $("#txtmarca-vehiculo").val(),
            modelo: $("#txtmodelo-vehiculo").val(),
            tipo_cuerpo: $("#txttipo_cuerpo-vehiculo").val(),
            color: $("#txtcolor-vehiculo").val(),
            numero_identificacion: $("#txtnum_ident-vehiculo").val(),
            anio_carro: $("#txtanio_carro-vehiculo").val() || null,
            fecha_robo: $("#txtfecha_robo-vehiculo").val() || null,
            descripcion: $("#txtdescripcion-vehiculo").val(),
            nombre_propietario: $("#txtnombrecompleto-vehiculo").val(),
            contacto_propietario: $("#txtcontacto-vehiculo").val(),
            tipo_documento: $("#txtident_tipo-vehiculo").val(),
            num_documento: $("#txtident_nro-vehiculo").val(),
            status: 1
        };
    }

    function doinsertVehiculo() {
        var values = getvaluesVehiculo();
        callAPI({
            method: "gestion/donewrob",
            post: 1,
            params: values,
            ok: (data) => {
                console.log('✅ Vehículo registrado con ID:', data.id);

                // Vincular el vehículo al incidente actual
                if (data && data.id) {
                    callAPI({
                        method: "gestincidencias/involvedentity",
                        post: 1,
                        params: {
                            entity_id: data.id,
                            entity_type: 2 // 2 = Vehículo robado
                        },
                        ok: (response) => {
                            console.log('✅ Vehículo vinculado al incidente correctamente');
                            // showNotification('Vehículo robado registrado y vinculado al incidente', 'success');
                        },
                        error: (error) => {
                            console.error('❌ Error al vincular vehículo al incidente:', error);
                        }
                    });
                }

                $("#modal-vehiculo-robado").modal('hide');
                $(".modal-backdrop").remove();

                // Limpiar formulario
                $('#modal-vehiculo-robado').find('input[type="text"], input[type="date"], input[type="integer"]').val('');
                $('#modal-vehiculo-robado').find('select').prop('selectedIndex', 0);
                $('#modal-vehiculo-robado').find('textarea').val('');
            }
        });
    }

    // Event listeners
    $('#btnSendNewVehiculo').on('click', function () {
        doinsertVehiculo();
    });
})();
</script>
