<div id="incidentes-supervisor-dashboard" class="civix-view">
    <style>
        /* Scoped styles for supervisor dashboard */
        #incidentes-supervisor-dashboard {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
        }

        /* Header mejorado con KPIs */
        #incidentes-supervisor-dashboard .dashboard-main-header {
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        #incidentes-supervisor-dashboard .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        #incidentes-supervisor-dashboard .header-title-section {
            flex: 1;
            min-width: 200px;
        }

        #incidentes-supervisor-dashboard .header-search-section {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        #incidentes-supervisor-dashboard .global-search-box {
            position: relative;
            min-width: 280px;
        }

        #incidentes-supervisor-dashboard .global-search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: #0f0f0f;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            color: #FFFFFF;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        #incidentes-supervisor-dashboard .global-search-input:focus {
            outline: none;
            border-color: #f67200;
            box-shadow: 0 0 0 3px rgba(246, 114, 0, 0.1);
        }

        #incidentes-supervisor-dashboard .global-search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            pointer-events: none;
        }

        /* KPIs Cards */
        #incidentes-supervisor-dashboard .kpis-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        #incidentes-supervisor-dashboard .kpi-card {
            background: #252525;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        #incidentes-supervisor-dashboard .kpi-card:hover {
            transform: translateY(-2px);
            border-color: #3a3a3a;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        #incidentes-supervisor-dashboard .kpi-card.border-warning {
            border-left: 4px solid #ffc107;
        }

        #incidentes-supervisor-dashboard .kpi-card.border-danger {
            border-left: 4px solid #dc3545;
        }

        #incidentes-supervisor-dashboard .kpi-card.border-primary {
            border-left: 4px solid #f67200;
        }

        #incidentes-supervisor-dashboard .kpi-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        #incidentes-supervisor-dashboard .kpi-icon.bg-primary {
            background: rgba(246, 114, 0, 0.1);
            color: #f67200;
        }

        #incidentes-supervisor-dashboard .kpi-icon.bg-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        #incidentes-supervisor-dashboard .kpi-icon.bg-danger {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        #incidentes-supervisor-dashboard .kpi-content {
            flex: 1;
        }

        #incidentes-supervisor-dashboard .kpi-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #FFFFFF;
            line-height: 1;
            margin-bottom: 4px;
        }

        #incidentes-supervisor-dashboard .kpi-label {
            font-size: 0.75rem;
            color: #a6adbb;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #incidentes-supervisor-dashboard .dashboard-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2a2a2a;
        }

        #incidentes-supervisor-dashboard .dashboard-title {
            font-size: 1.8rem;
            color: #FFFFFF;
            margin: 0 0 5px 0;
        }

        #incidentes-supervisor-dashboard .dashboard-subtitle {
            font-size: 0.9rem;
            color: #a6adbb;
            margin: 0;
        }

        /* Sección de operadores */
        #incidentes-supervisor-dashboard .section {
            margin-bottom: 30px;
        }

        #incidentes-supervisor-dashboard .section-title {
            font-size: 1.3rem;
            color: #FFFFFF;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #incidentes-supervisor-dashboard .section-title .badge {
            background: #f67200;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Grid vertical de operadores en columna */
        #incidentes-supervisor-dashboard .operators-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            padding: 5px;
            scrollbar-width: thin;
            scrollbar-color: #666 #222;
        }

        #incidentes-supervisor-dashboard .operators-list::-webkit-scrollbar {
            width: 6px;
        }

        #incidentes-supervisor-dashboard .operators-list::-webkit-scrollbar-track {
            background: #222;
        }

        #incidentes-supervisor-dashboard .operators-list::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 3px;
        }

        #incidentes-supervisor-dashboard .operator-item {
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 10px;
            padding: 12px 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #incidentes-supervisor-dashboard .operator-item:hover {
            background: #252525;
            border-color: #3a3a3a;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(246, 114, 0, 0.1);
        }

        #incidentes-supervisor-dashboard .operator-item:active {
            transform: translateY(-1px) scale(1.01);
        }

        #incidentes-supervisor-dashboard .operator-item.ending-shift {
            border-color: #ffc107;
            background: rgba(255, 193, 7, 0.05);
        }

        #incidentes-supervisor-dashboard .operator-item.ending-shift::before {
            content: '⚠️';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 1.2rem;
        }

        #incidentes-supervisor-dashboard .operator-icon {
            width: 40px;
            height: 40px;
            background: #2a2a2a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            position: relative;
            flex-shrink: 0;
        }

        #incidentes-supervisor-dashboard .operator-info {
            flex: 1;
            min-width: 0;
        }

        #incidentes-supervisor-dashboard .operator-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 3px;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #incidentes-supervisor-dashboard .operator-meta {
            font-size: 1rem;
            color: #a6adbb;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        #incidentes-supervisor-dashboard .ticket-count {
            background: #f67200;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        #incidentes-supervisor-dashboard .ticket-count i {
            font-size: 0.75rem;
        }

        #incidentes-supervisor-dashboard .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        #incidentes-supervisor-dashboard .status-dot.active {
            background: #22c55e;
            box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
        }

        #incidentes-supervisor-dashboard .status-dot.ending {
            background: #ffc107;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Lista de tickets */
        #incidentes-supervisor-dashboard .tickets-container {
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 12px;
            padding: 15px;
            max-height: calc(100vh - 400px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #666 #222;
        }

        #incidentes-supervisor-dashboard .tickets-container::-webkit-scrollbar {
            width: 6px;
        }

        #incidentes-supervisor-dashboard .tickets-container::-webkit-scrollbar-track {
            background: #222;
        }

        #incidentes-supervisor-dashboard .tickets-container::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 3px;
        }

        #incidentes-supervisor-dashboard .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a6adbb;
        }

        #incidentes-supervisor-dashboard .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        #incidentes-supervisor-dashboard .empty-state p {
            font-size: 1.1.2rem;
            margin: 0;
        }

        #incidentes-supervisor-dashboard .tickets-list {
            display: grid;
            gap: 12px;
        }

        #incidentes-supervisor-dashboard .ticket-card {
            background: #252525;
            border: 2px solid #2a2a2a;
            border-left: 4px solid #f67200;
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        #incidentes-supervisor-dashboard .ticket-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(246, 114, 0, 0.05) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        #incidentes-supervisor-dashboard .ticket-card:hover {
            background: #2a2a2a;
            transform: translateX(6px) translateY(-2px);
            border-color: #3a3a3a;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(246, 114, 0, 0.1);
        }

        #incidentes-supervisor-dashboard .ticket-card:hover::before {
            opacity: 1;
        }

        #incidentes-supervisor-dashboard .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        #incidentes-supervisor-dashboard .ticket-id {
            font-size: 1.2rem;
            font-weight: 600;
            color: #FFFFFF;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #incidentes-supervisor-dashboard .priority-circle {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        #incidentes-supervisor-dashboard .priority-critica {
            background: #dc3545;
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.6);
        }

        #incidentes-supervisor-dashboard .priority-alta {
            background: #ff7a2f;
            box-shadow: 0 0 8px rgba(255, 122, 47, 0.6);
        }

        #incidentes-supervisor-dashboard .priority-media {
            background: #ffc107;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
        }

        #incidentes-supervisor-dashboard .priority-baja {
            background: #28a745;
            box-shadow: 0 0 8px rgba(40, 167, 69, 0.6);
        }

        #incidentes-supervisor-dashboard .ticket-status {
            font-size: 0.7rem;
            padding: 5px 12px;
            border-radius: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        #incidentes-supervisor-dashboard .ticket-status.abierto {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1.5px solid rgba(59, 130, 246, 0.4);
        }

        #incidentes-supervisor-dashboard .ticket-status.asignado {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            border: 1.5px solid rgba(139, 92, 246, 0.4);
        }

        #incidentes-supervisor-dashboard .ticket-status.en-atencion {
            background: rgba(255, 193, 7, 0.15);
            color: #fbbf24;
            border: 1.5px solid rgba(255, 193, 7, 0.4);
        }

        #incidentes-supervisor-dashboard .ticket-body {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-top: 12px;
        }

        #incidentes-supervisor-dashboard .ticket-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        #incidentes-supervisor-dashboard .info-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            color: #a6adbb;
        }

        #incidentes-supervisor-dashboard .info-row i {
            color: #f67200;
            width: 16px;
        }

        #incidentes-supervisor-dashboard .info-row strong {
            color: #FFFFFF;
        }

        #incidentes-supervisor-dashboard .ticket-time {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 10px;
        }

        #incidentes-supervisor-dashboard .time-label {
            font-size: 1rem;
            color: #a6adbb;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        #incidentes-supervisor-dashboard .time-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #f67200;
        }

        /* Buscador de operadores */
        #incidentes-supervisor-dashboard .search-box {
            margin-bottom: 15px;
            position: relative;
        }

        #incidentes-supervisor-dashboard .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            color: #FFFFFF;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        #incidentes-supervisor-dashboard .search-input:focus {
            outline: none;
            border-color: #f67200;
            box-shadow: 0 0 0 3px rgba(246, 114, 0, 0.1);
        }

        #incidentes-supervisor-dashboard .search-input::placeholder {
            color: #6b7280;
        }

        #incidentes-supervisor-dashboard .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            pointer-events: none;
        }

        /* Checkbox circular para selección de tickets */
        .ticket-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #666;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .ticket-checkbox:checked {
            border-color: #f67200;
            background: #f67200;
        }

        .ticket-checkbox:checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 12px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .ticket-card.selected {
            border-left-color: #f67200;
            background: rgba(246, 114, 0, 0.05);
        }

        /* Estilos para la tabla de tickets */
        #incidentes-supervisor-dashboard .tickets-table-container {
            overflow-x: auto;
            border-radius: 12px;
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
        }

        #incidentes-supervisor-dashboard .tickets-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        #incidentes-supervisor-dashboard .tickets-table thead {
            background: #252525;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #incidentes-supervisor-dashboard .tickets-table th {
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #f67200;
            border-bottom: 2px solid #2a2a2a;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #incidentes-supervisor-dashboard .tickets-table tbody tr {
            border-bottom: 1px solid #2a2a2a;
            transition: all 0.2s ease;
        }

        #incidentes-supervisor-dashboard .tickets-table tbody tr:hover {
            background: rgba(246, 114, 0, 0.05);
        }

        #incidentes-supervisor-dashboard .tickets-table tbody tr.selected {
            background: rgba(246, 114, 0, 0.1);
            border-left: 3px solid #f67200;
        }

        #incidentes-supervisor-dashboard .tickets-table td {
            padding: 14px 12px;
            color: #FFFFFF;
            vertical-align: middle;
        }

        #incidentes-supervisor-dashboard .ticket-id-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #f67200;
        }

        #incidentes-supervisor-dashboard .ticket-type-cell {
            font-weight: 500;
        }

        #incidentes-supervisor-dashboard .ticket-operator-cell {
            color: #a6adbb;
        }

        #incidentes-supervisor-dashboard .reassign-btn {
            padding: 8px 16px;
            background: #f67200;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        #incidentes-supervisor-dashboard .reassign-btn:hover {
            background: #ff8c1a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(246, 114, 0, 0.3);
        }

        #incidentes-supervisor-dashboard .reassign-btn:active {
            transform: translateY(0);
        }

        /* Badge de ticket reasignado */
        .ticket-reassigned-badge {
            display: inline-block;
            margin-left: 8px;
            padding: 3px 8px;
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* Botón de historial */
        #incidentes-supervisor-dashboard .history-btn {
            padding: 8px 12px;
            background: transparent;
            color: #60a5fa;
            border: 1.5px solid #60a5fa;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        #incidentes-supervisor-dashboard .history-btn:hover {
            background: rgba(96, 165, 250, 0.1);
            border-color: #93c5fd;
            color: #93c5fd;
            transform: translateY(-1px);
        }

        /* Paginador */
        #incidentes-supervisor-dashboard .dataTables_paginate {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }

        #incidentes-supervisor-dashboard .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            gap: 5px;
        }

        #incidentes-supervisor-dashboard .paginate_button {
            display: inline-block;
        }

        #incidentes-supervisor-dashboard .paginate_button a {
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            color: #a6adbb;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: inline-block;
            cursor: pointer;
        }

        #incidentes-supervisor-dashboard .paginate_button a:hover {
            background: #252525;
            border-color: #3a3a3a;
            color: #FFFFFF;
        }

        #incidentes-supervisor-dashboard .paginate_button.active a {
            background: #f67200;
            border-color: #f67200;
            color: white;
            font-weight: 600;
        }

        #incidentes-supervisor-dashboard .paginate_button.disabled a {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Timeline de historial */
        .history-timeline {
            position: relative;
            padding-left: 30px;
        }

        .history-timeline-item {
            position: relative;
            padding-bottom: 20px;
            border-left: 2px solid #2a2a2a;
            padding-left: 20px;
        }

        .history-timeline-item:last-child {
            border-left-color: transparent;
            padding-bottom: 0;
        }

        .history-timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #f67200;
            border: 2px solid #1a1a1a;
        }

        .history-timeline-item.reassignment::before {
            background: #8b5cf6;
        }

        .history-timeline-item.creation::before {
            background: #22c55e;
        }

        .history-timeline-time {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .history-timeline-content {
            color: #FFFFFF;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .history-timeline-content strong {
            color: #f67200;
        }

        .history-timeline-content .operator-name {
            color: #8b5cf6;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            #incidentes-supervisor-dashboard .operators-grid {
                grid-template-columns: 1fr;
            }

            #incidentes-supervisor-dashboard .ticket-body {
                grid-template-columns: 1fr;
            }

            #incidentes-supervisor-dashboard .tickets-table {
                font-size: 0.8rem;
            }

            #incidentes-supervisor-dashboard .tickets-table th,
            #incidentes-supervisor-dashboard .tickets-table td {
                padding: 10px 8px;
            }
        }
    </style>

    <!-- Header Principal con KPIs -->
    <div class="dashboard-main-header">
        <!-- <div class="header-top">
            <div class="header-title-section">
                <h1 class="dashboard-title" style="margin: 0 0 5px 0;">Dashboard Supervisor</h1>
                <p class="dashboard-subtitle" style="margin: 0;">Reasignación de Tickets</p>
            </div>
            <div class="header-search-section">
                <div class="global-search-box">
                    <input
                        type="text"
                        id="globalSearch"
                        class="global-search-input"
                        placeholder="Buscar ticket, operador, agente..."
                    />
                    <i class="pe-7s-search global-search-icon" aria-hidden="true"></i>
                </div>
            </div>
        </div> -->

        <!-- KPIs -->
        <div class="kpis-container">
            <div class="kpi-card border-primary">
                <div class="kpi-icon bg-primary">
                    <i class="pe-7s-note2" aria-hidden="true"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-value" id="kpiTotalTickets">0</div>
                    <div class="kpi-label">Tickets activos</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Layout de 2 columnas -->
    <div style="display: grid; grid-template-columns: 70% 30%; gap: 20px; height: calc(100vh - 400px);">

        <!-- COLUMNA DERECHA: Tickets -->
        <div class="section" style="margin-bottom: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 class="section-title" style="margin-bottom: 0;">
                    <i class="pe-7s-note2" aria-hidden="true"></i>
                    Gestión de Tickets
                </h2>
                <button
                    id="reassignSelectedBtn"
                    class="btn btn-accent"
                    style="display: none;"
                    onclick="window.supervisorDashboard.openReassignModal()"
                >
                    <i class="pe-7s-repeat" aria-hidden="true"></i> Reasignar Seleccionados (<span id="selectedTicketsCount">0</span>)
                </button>
            </div>
    
            <!-- Tabs de Tickets (dinámicos) -->
            <div id="ticketTabsContainer" style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid #2a2a2a; padding-bottom: 5px; overflow-x: auto; white-space: nowrap;">
                <button
                    class="ticket-filter-tab active"
                    data-filter="all"
                    data-operator=""
                    style="background: none; border: none; color: #FFFFFF; font-size: 1.2rem; padding: 8px 16px; cursor: pointer; border-bottom: 3px solid #f67200; transition: all 0.3s;"
                >
                    Todos <small><span class="badge" id="allTicketsCount">0</span></small>
                </button>
                <button
                    class="ticket-filter-tab"
                    data-filter="reassigned"
                    data-operator=""
                    style="background: none; border: none; color: #a6adbb; font-size: 1.2rem; padding: 8px 16px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s;"
                >
                    Reasignados <small><span class="badge" id="reassignedTicketsCount">0</span></small>
                </button>
                <button
                    class="ticket-filter-tab"
                    data-filter="not-reassigned"
                    data-operator=""
                    style="background: none; border: none; color: #a6adbb; font-size: 1.2rem; padding: 8px 16px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s;"
                >
                    No Reasignados <small><span class="badge" id="notReassignedTicketsCount">0</span></small>
                </button>
                <!-- Los tabs de operadores se agregarán aquí dinámicamente -->
            </div>
    
            <!-- Buscador de tickets -->
            <div class="search-box" style="margin-bottom: 15px;">
                <input
                    type="text"
                    id="ticketSearch"
                    class="search-input"
                    placeholder="Buscar ticket por ID, tipo o agente..."
                />
                <i class="pe-7s-search search-icon" aria-hidden="true"></i>
            </div>
    
            <div class="tickets-table-container">
                <table class="tickets-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" class="ticket-checkbox" id="selectAllTickets" title="Seleccionar todos">
                            </th>
                            <th>ID</th>
                            <th>Tipo de Incidente</th>
                            <th>Estado</th>
                            <th>Operador Actual</th>
                            <th>Reasignado por</th>
                            <th>Prioridad</th>
                            <th>SLA</th>
                            <th style="text-align: center;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="ticketsTableBody">
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 60px 20px; color: #a6adbb;">
                                <i class="pe-7s-note2" aria-hidden="true" style="font-size: 3rem; opacity: 0.3; display: block; margin-bottom: 10px;"></i>
                                <p>No hay tickets activos</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginador -->
            <div class="dataTables_paginate paging_simple_numbers" id="ticketsPagination" style="margin-top: 20px;">
                <ul class="pagination" id="paginationList">
                    <!-- Se genera dinámicamente -->
                </ul>
            </div>

        </div>

        <!-- COLUMNA IZQUIERDA: Operadores -->
        <div class="section" style="margin-bottom: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 class="section-title" style="margin-bottom: 0;">
                    <i class="pe-7s-users" aria-hidden="true"></i>
                    Operadores en Turno
                    <span class="badge" id="operatorsCount">0</span>
                </h2>
                
            </div>
            <div class="search-box">
                    <input
                        type="text"
                        id="operatorSearch"
                        class="search-input"
                        placeholder="Buscar operador..."
                    />
                    <i class="pe-7s-search search-icon" aria-hidden="true"></i>
            </div>
            <!-- Filtros de operadores -->
            <div style="display: flex; gap: 8px; margin-bottom: 8px; padding-bottom: 8px;">
                <button
                    class="operator-filter-tab active"
                    data-filter="all"
                    style="background: none; border: none; color: #FFFFFF; font-size: 1.2rem; padding: 6px 12px; cursor: pointer; border-bottom: 2px solid #f67200; transition: all 0.3s;"
                >
                    Todos <span class="badge" style="background: #555; font-size: 1rem; padding: 2px 6px;" id="allOperatorsCount">0</span>
                </button>
                <button
                    class="operator-filter-tab"
                    data-filter="active"
                    style="background: none; border: none; color: #a6adbb; font-size: 1.2rem; padding: 6px 12px; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.3s;"
                >
                    Activos <span class="badge" style="background: #555; font-size: 1rem; padding: 2px 6px;" id="activeOperatorsCount">0</span>
                </button>
                <button
                    class="operator-filter-tab"
                    data-filter="ending"
                    style="background: none; border: none; color: #a6adbb; font-size: 1.2rem; padding: 6px 12px; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.3s;"
                >
                    Terminando <span class="badge" style="background: #555; font-size: 1rem; padding: 2px 6px;" id="endingOperatorsCount">0</span>
                </button>
            </div>

            <div class="operators-list" id="operatorsList">
                <!-- Los operadores se renderizan aquí con JS -->
            </div>
        </div>

        
    </div>

    <!-- Modal de Reasignación (Bootstrap) -->
    <div class="modal fade" id="reassignModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header text-left">
                    <h4 class="modal-title mb-0">Reasignar Tickets</h4>
                    <h7 class="mb-0" id="reassignModalSubtitle">Seleccione el operador destino</h7>
                </div>
                <div class="modal-body">
                    <div id="reassignModalBody">
                        <!-- El contenido se renderiza dinámicamente -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-rounded" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-accent btn-rounded" id="confirmReassignBtn" disabled onclick="window.supervisorDashboard.confirmReassignment()">
                        Confirmar Reasignación
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Historial de Ticket -->
    <div class="modal fade" id="ticketHistoryModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header text-left">
                    <h4 class="modal-title mb-0">Historial del Ticket</h4>
                    <h7 class="mb-0" id="historyModalSubtitle">Timeline de eventos y reasignaciones</h7>
                </div>
                <div class="modal-body">
                    <div id="ticketHistoryBody">
                        <!-- El contenido se renderiza dinámicamente -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-rounded" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    (function() {
        // Variables globales del dashboard
        let operatorSearchTerm = '';
        let operatorFilter = 'all';
        let selectedTickets = [];
        let selectedOperatorForReassign = null;
        let reassignmentHistory = [];
        let ticketFilter = 'all';
        let activeOperatorTab = null;
        let openOperatorTabs = [];
        let ticketSearchTerm = '';
        let currentSupervisor = 'Supervisor 1';
        let currentPage = 1;
        let itemsPerPage = 10;
        let ticketHistory = {};

        // Datos de ejemplo (estos vendrían del backend en tiempo real)
        let operatorsData = [
            {
                id: 'op1',
                name: 'Juan Pérez',
                status: 'active',
                ticketsCount: 3,
                endingShift: false,
                tickets: [
                    {
                        id: 'INC-2025-001',
                        name: 'Robo de Vehículo',
                        priority: 'critica',
                        status: 'en-atencion',
                        startTime: new Date(Date.now() - 45 * 60000), // 45 min ago
                        assignedAgent: 'Agente Ramírez'
                    },
                    {
                        id: 'INC-2025-005',
                        name: 'Persona Sospechosa',
                        priority: 'media',
                        status: 'asignado',
                        startTime: new Date(Date.now() - 20 * 60000), // 20 min ago
                        assignedAgent: 'Agente Torres'
                    },
                    {
                        id: 'INC-2025-008',
                        name: 'Vehículo Sospechoso',
                        priority: 'alta',
                        status: 'abierto',
                        startTime: new Date(Date.now() - 10 * 60000), // 10 min ago
                        assignedAgent: null
                    },
                    {
                        id: 'INC-2025-011',
                        name: 'Persona Desaparecida',
                        priority: 'alta',
                        status: 'cerrado',
                        startTime: new Date(Date.now() - 120 * 60000), // 2 hours ago
                        assignedAgent: 'Agente Ramírez'
                    }
                ]
            },
            {
                id: 'op2',
                name: 'María González',
                status: 'active',
                ticketsCount: 2,
                endingShift: true,
                tickets: [
                    {
                        id: 'INC-2025-003',
                        name: 'Persona Desaparecida',
                        priority: 'alta',
                        status: 'en-atencion',
                        startTime: new Date(Date.now() - 90 * 60000), // 1.5 hours ago
                        assignedAgent: 'Agente Vega'
                    },
                    {
                        id: 'INC-2025-007',
                        name: 'Robo de Vehículo',
                        priority: 'critica',
                        status: 'asignado',
                        startTime: new Date(Date.now() - 5 * 60000), // 5 min ago
                        assignedAgent: 'Agente López'
                    }
                ]
            },
            {
                id: 'op3',
                name: 'Carlos Ruiz',
                status: 'active',
                ticketsCount: 5,
                endingShift: false,
                tickets: [
                    {
                        id: 'INC-2025-002',
                        name: 'Persona Requisitoriada',
                        priority: 'alta',
                        status: 'en-atencion',
                        startTime: new Date(Date.now() - 120 * 60000), // 2 hours ago
                        assignedAgent: 'Agente García'
                    },
                    {
                        id: 'INC-2025-004',
                        name: 'Otra Incidencia',
                        priority: 'baja',
                        status: 'abierto',
                        startTime: new Date(Date.now() - 15 * 60000),
                        assignedAgent: null
                    },
                    {
                        id: 'INC-2025-006',
                        name: 'Vehículo Sospechoso',
                        priority: 'media',
                        status: 'asignado',
                        startTime: new Date(Date.now() - 30 * 60000),
                        assignedAgent: 'Agente Martínez'
                    },
                    {
                        id: 'INC-2025-009',
                        name: 'Robo de Vehículo',
                        priority: 'critica',
                        status: 'en-atencion',
                        startTime: new Date(Date.now() - 60 * 60000),
                        assignedAgent: 'Agente Fernández'
                    },
                    {
                        id: 'INC-2025-010',
                        name: 'Persona Sospechosa',
                        priority: 'alta',
                        status: 'abierto',
                        startTime: new Date(Date.now() - 8 * 60000),
                        assignedAgent: null
                    }
                ]
            },
            {
                id: 'op4',
                name: 'Ana López',
                status: 'active',
                ticketsCount: 1,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op5',
                name: 'Pedro Martínez',
                status: 'active',
                ticketsCount: 4,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op6',
                name: 'Laura Torres',
                status: 'active',
                ticketsCount: 2,
                endingShift: true,
                tickets: []
            },
            {
                id: 'op7',
                name: 'Diego Ramírez',
                status: 'active',
                ticketsCount: 3,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op8',
                name: 'Carmen Silva',
                status: 'active',
                ticketsCount: 0,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op9',
                name: 'Roberto Vega',
                status: 'active',
                ticketsCount: 6,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op10',
                name: 'Isabel Castro',
                status: 'active',
                ticketsCount: 2,
                endingShift: true,
                tickets: []
            },
            {
                id: 'op11',
                name: 'Miguel Flores',
                status: 'active',
                ticketsCount: 3,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op12',
                name: 'Patricia Rojas',
                status: 'active',
                ticketsCount: 1,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op13',
                name: 'Fernando Díaz',
                status: 'active',
                ticketsCount: 5,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op14',
                name: 'Sofía Mendoza',
                status: 'active',
                ticketsCount: 2,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op15',
                name: 'Andrés Herrera',
                status: 'active',
                ticketsCount: 4,
                endingShift: true,
                tickets: []
            },
            {
                id: 'op16',
                name: 'Valentina Ortiz',
                status: 'active',
                ticketsCount: 3,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op17',
                name: 'Ricardo Núñez',
                status: 'active',
                ticketsCount: 2,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op18',
                name: 'Elena Vargas',
                status: 'active',
                ticketsCount: 1,
                endingShift: true,
                tickets: []
            },
            {
                id: 'op19',
                name: 'Javier Morales',
                status: 'active',
                ticketsCount: 5,
                endingShift: false,
                tickets: []
            },
            {
                id: 'op20',
                name: 'Lucía Reyes',
                status: 'active',
                ticketsCount: 3,
                endingShift: false,
                tickets: []
            }
        ];

        // Generar 50 tickets distribuidos entre operadores
        (function generateTickets() {
            const ticketTypes = ['Robo de Vehículo', 'Persona Sospechosa', 'Persona Desaparecida', 'Vehículo Sospechoso', 'Otra Incidencia', 'Accidente de Tránsito', 'Disturbios', 'Incendio'];
            const priorities = ['critica', 'alta', 'media', 'baja'];
            const statuses = ['abierto', 'asignado', 'en-atencion'];
            const agents = ['Agente Ramírez', 'Agente Vega', 'Agente Torres', 'Agente López', 'Agente García', 'Agente Martínez', 'Agente Fernández', 'Agente Castro', 'Agente Silva', null];

            let ticketCounter = 1;

            operatorsData.forEach(function(operator) {
                const numTickets = operator.ticketsCount;
                operator.tickets = [];

                for (let i = 0; i < numTickets; i++) {
                    const ticketId = 'INC-2025-' + String(ticketCounter).padStart(3, '0');
                    const randomMinutes = Math.floor(Math.random() * 180); // Random 0-180 minutos
                    const createdTime = new Date(Date.now() - randomMinutes * 60000);
                    const assignedAgent = agents[Math.floor(Math.random() * agents.length)];

                    operator.tickets.push({
                        id: ticketId,
                        name: ticketTypes[Math.floor(Math.random() * ticketTypes.length)],
                        priority: priorities[Math.floor(Math.random() * priorities.length)],
                        status: statuses[Math.floor(Math.random() * statuses.length)],
                        startTime: createdTime,
                        assignedAgent: assignedAgent
                    });

                    // Inicializar historial del ticket
                    ticketHistory[ticketId] = [
                        {
                            type: 'creation',
                            timestamp: createdTime,
                            description: 'Ticket creado',
                            operatorName: operator.name,
                            supervisorName: null
                        },
                        {
                            type: 'assignment',
                            timestamp: new Date(createdTime.getTime() + 5 * 60000), // 5 min después
                            description: 'Ticket asignado a ' + operator.name,
                            operatorName: operator.name,
                            supervisorName: 'Sistema',
                            agentName: assignedAgent
                        }
                    ];

                    ticketCounter++;
                }
            });
        })();

        // Función para calcular tiempo transcurrido
        function getElapsedTime(startTime) {
            const now = new Date();
            const diff = now - startTime;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;

            if (hours > 0) {
                return hours + 'h ' + mins + 'm';
            }
            return mins + 'm';
        }

        // Función para renderizar operadores
        function renderOperators() {
            const list = document.getElementById('operatorsList');
            const countBadge = document.getElementById('operatorsCount');

            if (!list) return;

            // Filtrar operadores por búsqueda y filtro de estado
            let filteredOperators = operatorsData.filter(function(operator) {
                // Filtro de búsqueda
                const matchesSearch = operatorSearchTerm.trim() === '' ||
                    operator.name.toLowerCase().includes(operatorSearchTerm.toLowerCase());

                // Filtro de estado
                let matchesFilter = true;
                if (operatorFilter === 'active') {
                    matchesFilter = !operator.endingShift;
                } else if (operatorFilter === 'ending') {
                    matchesFilter = operator.endingShift;
                }

                return matchesSearch && matchesFilter;
            });

            // Actualizar contadores
            const allCount = operatorsData.length;
            const activeCount = operatorsData.filter(op => !op.endingShift).length;
            const endingCount = operatorsData.filter(op => op.endingShift).length;

            document.getElementById('allOperatorsCount').textContent = allCount;
            document.getElementById('activeOperatorsCount').textContent = activeCount;
            document.getElementById('endingOperatorsCount').textContent = endingCount;

            list.innerHTML = '';
            countBadge.textContent = filteredOperators.length;

            if (filteredOperators.length === 0) {
                list.innerHTML = '<div class="empty-state"><i class="pe-7s-search" aria-hidden="true"></i><p>No se encontraron operadores</p></div>';
                return;
            }

            filteredOperators.forEach(function(operator) {
                const item = document.createElement('div');
                item.className = 'operator-item';

                if (operator.endingShift) {
                    item.classList.add('ending-shift');
                }

                const statusDotClass = operator.endingShift ? 'ending' : 'active';
                const statusText = operator.endingShift ? 'Turno terminando' : 'Activo';

                item.innerHTML =
                    '<div class="operator-icon">' +
                        '👤' +
                        '<span class="status-dot ' + statusDotClass + '" style="position: absolute; bottom: 2px; right: 2px;"></span>' +
                    '</div>' +
                    '<div class="operator-info">' +
                        '<div class="operator-name" title="' + operator.name + '">' + operator.name + '</div>' +
                        '<div class="operator-meta">' +
                            '<span class="status-dot ' + statusDotClass + '"></span>' +
                            statusText +
                        '</div>' +
                    '</div>' +
                    '<div class="ticket-count">' +
                        '<i class="pe-7s-note2" aria-hidden="true"></i>' +
                        operator.ticketsCount +
                    '</div>';

                // Click en operador para abrir su tab
                item.addEventListener('click', function() {
                    openOperatorTab(operator.id, operator.name);
                });

                list.appendChild(item);
            });
        }

        // Función para abrir tab de operador
        function openOperatorTab(operatorId, operatorName) {
            // Si ya está abierto, solo activarlo
            if (openOperatorTabs.includes(operatorId)) {
                activeOperatorTab = operatorId;
                updateTicketTabs();
                renderTickets();
                return;
            }

            // Agregar a tabs abiertos
            openOperatorTabs.push(operatorId);
            activeOperatorTab = operatorId;

            // Renderizar tabs y tickets
            updateTicketTabs();
            renderTickets();
        }

        // Función para cerrar tab de operador
        function closeOperatorTab(operatorId) {
            openOperatorTabs = openOperatorTabs.filter(id => id !== operatorId);

            // Si cerramos el tab activo, volver a "Todos"
            if (activeOperatorTab === operatorId) {
                activeOperatorTab = null;
                ticketFilter = 'all';
            }

            updateTicketTabs();
            renderTickets();
        }

        // Función para actualizar los tabs de tickets
        function updateTicketTabs() {
            const container = document.getElementById('ticketTabsContainer');
            if (!container) return;

            // Mantener los tabs fijos (Todos, Reasignados, No Reasignados)
            const fixedTabs = Array.from(container.querySelectorAll('[data-filter]'));

            // Limpiar tabs de operadores
            container.querySelectorAll('[data-operator]:not([data-operator=""])').forEach(tab => tab.remove());

            // Agregar tabs de operadores abiertos
            openOperatorTabs.forEach(function(operatorId) {
                const operator = operatorsData.find(op => op.id === operatorId);
                if (!operator) return;

                const tab = document.createElement('button');
                tab.className = 'ticket-filter-tab';
                tab.setAttribute('data-operator', operatorId);
                tab.setAttribute('data-filter', 'operator');

                if (activeOperatorTab === operatorId) {
                    tab.classList.add('active');
                    tab.style.color = '#FFFFFF';
                    tab.style.borderBottomColor = '#f67200';
                } else {
                    tab.style.color = '#a6adbb';
                    tab.style.borderBottomColor = 'transparent';
                }

                tab.style.background = 'none';
                tab.style.border = 'none';
                tab.style.fontSize = '1.2rem';
                tab.style.padding = '8px 16px';
                tab.style.paddingRight = '8px';
                tab.style.cursor = 'pointer';
                tab.style.borderBottom = '3px solid';
                tab.style.transition = 'all 0.3s';
                tab.style.display = 'flex';
                tab.style.alignItems = 'center';
                tab.style.gap = '8px';

                const ticketCount = operator.tickets.filter(t => t.status !== 'cerrado').length;

                tab.innerHTML =
                    '<span>👤 ' + operator.name + '</span>' +
                    '<small><span class="badge">' + ticketCount + '</span></small>' +
                    '<button onclick="event.stopPropagation(); window.supervisorDashboard.closeOperatorTab(\'' + operatorId + '\')" style="background: none; border: none; color: #ef4444; cursor: pointer; padding: 0 4px; margin-left: 4px; font-size: 1.1.2rem;">×</button>';

                tab.addEventListener('click', function() {
                    activeOperatorTab = operatorId;
                    ticketFilter = 'all'; // Reset filter when switching to operator tab
                    currentPage = 1; // Resetear a la primera página
                    updateTicketTabs();
                    renderTickets();
                });

                container.appendChild(tab);
            });

            // Actualizar estado de tabs fijos y agregar event listeners
            const updatedFixedTabs = Array.from(container.querySelectorAll('[data-filter]'));
            updatedFixedTabs.forEach(function(tab) {
                const filter = tab.getAttribute('data-filter');

                if (activeOperatorTab === null && filter === ticketFilter) {
                    tab.classList.add('active');
                    tab.style.color = '#FFFFFF';
                    tab.style.borderBottomColor = '#f67200';
                } else {
                    tab.classList.remove('active');
                    tab.style.color = '#a6adbb';
                    tab.style.borderBottomColor = 'transparent';
                }

                // Remover event listeners anteriores clonando el nodo
                const newTab = tab.cloneNode(true);
                tab.parentNode.replaceChild(newTab, tab);

                // Agregar nuevo event listener
                newTab.addEventListener('click', function() {
                    activeOperatorTab = null; // Desactivar tab de operador
                    ticketFilter = filter; // Establecer el filtro correcto
                    currentPage = 1; // Resetear a la primera página
                    updateTicketTabs(); // Actualizar tabs
                    renderTickets(); // Renderizar tickets
                });
            });
        }

        // Función para renderizar todos los tickets en tabla
        function renderTickets() {
            const tbody = document.getElementById('ticketsTableBody');
            if (!tbody) return;

            // Recopilar tickets según el tab activo
            let allTickets = [];

            if (activeOperatorTab) {
                // Mostrar solo tickets del operador seleccionado
                const operator = operatorsData.find(op => op.id === activeOperatorTab);
                if (operator) {
                    operator.tickets.forEach(function(ticket) {
                        allTickets.push({
                            ...ticket,
                            operatorId: operator.id,
                            operatorName: operator.name,
                            isReassigned: reassignmentHistory.some(function(h) {
                                return h.ticketId === ticket.id;
                            })
                        });
                    });
                }
            } else {
                // Mostrar todos los tickets
                operatorsData.forEach(function(operator) {
                    operator.tickets.forEach(function(ticket) {
                        allTickets.push({
                            ...ticket,
                            operatorId: operator.id,
                            operatorName: operator.name,
                            isReassigned: reassignmentHistory.some(function(h) {
                                return h.ticketId === ticket.id;
                            })
                        });
                    });
                });
            }

            // Filtrar tickets cerrados
            allTickets = allTickets.filter(function(ticket) {
                return ticket.status !== 'cerrado';
            });

            // Aplicar filtro de reasignación
            if (ticketFilter === 'reassigned') {
                allTickets = allTickets.filter(function(ticket) {
                    return ticket.isReassigned;
                });
            } else if (ticketFilter === 'not-reassigned') {
                allTickets = allTickets.filter(function(ticket) {
                    return !ticket.isReassigned;
                });
            }

            // Aplicar búsqueda
            if (ticketSearchTerm.trim() !== '') {
                const searchLower = ticketSearchTerm.toLowerCase();
                allTickets = allTickets.filter(function(ticket) {
                    return ticket.id.toLowerCase().includes(searchLower) ||
                           ticket.name.toLowerCase().includes(searchLower) ||
                           (ticket.assignedAgent && ticket.assignedAgent.toLowerCase().includes(searchLower)) ||
                           ticket.operatorName.toLowerCase().includes(searchLower);
                });
            }

            // Actualizar contadores globales
            updateTicketCounts();

            // Calcular paginación
            const totalPages = Math.ceil(allTickets.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedTickets = allTickets.slice(startIndex, endIndex);

            // Limpiar tbody
            tbody.innerHTML = '';

            if (allTickets.length === 0) {
                tbody.innerHTML =
                    '<tr>' +
                        '<td colspan="9" style="text-align: center; padding: 60px 20px; color: #a6adbb;">' +
                            '<i class="pe-7s-note2" aria-hidden="true" style="font-size: 3rem; opacity: 0.3; display: block; margin-bottom: 10px;"></i>' +
                            '<p>No hay tickets que mostrar</p>' +
                        '</td>' +
                    '</tr>';
                renderPagination(0, 0);
                return;
            }

            // Renderizar filas de tabla (solo las de la página actual)
            paginatedTickets.forEach(function(ticket) {
                const tr = document.createElement('tr');

                const priorityClass = 'priority-' + ticket.priority;
                const statusClass = ticket.status;
                const elapsedTime = getElapsedTime(ticket.startTime);

                const statusText = {
                    'abierto': 'Abierto',
                    'asignado': 'Asignado',
                    'en-atencion': 'En Atención'
                }[ticket.status] || ticket.status;

                const priorityText = {
                    'critica': 'Crítica',
                    'alta': 'Alta',
                    'media': 'Media',
                    'baja': 'Baja'
                }[ticket.priority] || ticket.priority;

                // Verificar si el ticket está seleccionado
                const isSelected = selectedTickets.includes(ticket.id);
                if (isSelected) {
                    tr.classList.add('selected');
                }

                // Buscar historial de reasignación para obtener el supervisor
                const reassignHistory = reassignmentHistory.find(function(h) {
                    return h.ticketId === ticket.id;
                });

                const reassignedBy = reassignHistory ? reassignHistory.supervisorName : '—';
                const reassignedBadge = ticket.isReassigned
                    ? '<span class="ticket-reassigned-badge">REASIGNADO</span>'
                    : '';

                tr.innerHTML =
                    '<td>' +
                        '<input type="checkbox" class="ticket-checkbox" data-ticket-id="' + ticket.id + '" ' + (isSelected ? 'checked' : '') + '>' +
                    '</td>' +
                    '<td>' +
                        '<div class="ticket-id-cell">' +
                            '<span class="priority-circle ' + priorityClass + '"></span>' +
                            ticket.id +
                        '</div>' +
                    '</td>' +
                    '<td>' +
                        '<div class="ticket-type-cell">' +
                            ticket.name + reassignedBadge +
                        '</div>' +
                    '</td>' +
                    '<td>' +
                        '<span class="ticket-status ' + statusClass + '">' + statusText + '</span>' +
                    '</td>' +
                    '<td>' +
                        '<div class="ticket-operator-cell">' + ticket.operatorName + '</div>' +
                    '</td>' +
                    '<td>' +
                        '<span style="color: #8b5cf6; font-weight: 500;">' + reassignedBy + '</span>' +
                    '</td>' +
                    '<td>' +
                        '<span class="priority-circle ' + priorityClass + '"></span> ' + priorityText +
                    '</td>' +
                    '<td>' +
                        '<div style="display: flex; align-items: center; gap: 4px;">' +
                            '<i class="pe-7s-clock" aria-hidden="true"></i>' +
                            elapsedTime +
                        '</div>' +
                    '</td>' +
                    '<td style="text-align: center;">' +
                        '<div style="display: flex; gap: 8px; justify-content: center;">' +
                            '<button class="history-btn" data-ticket-id="' + ticket.id + '" title="Ver historial">' +
                                '<i class="pe-7s-look" aria-hidden="true"></i>' +
                            '</button>' +
                            '<button class="reassign-btn" data-ticket-id="' + ticket.id + '">' +
                                '<i class="pe-7s-repeat" aria-hidden="true"></i> Reasignar' +
                            '</button>' +
                        '</div>' +
                    '</td>';

                tbody.appendChild(tr);
            });

            // Renderizar paginador
            renderPagination(allTickets.length, totalPages);
        }

        // Función para actualizar contadores de tickets
        function updateTicketCounts() {
            // Calcular tickets GLOBALES (todos los operadores, sin filtrar por tab activo)
            let allGlobalTickets = [];

            operatorsData.forEach(function(operator) {
                operator.tickets.forEach(function(ticket) {
                    if (ticket.status !== 'cerrado') {
                        allGlobalTickets.push({
                            ...ticket,
                            operatorId: operator.id,
                            operatorName: operator.name,
                            isReassigned: reassignmentHistory.some(function(h) {
                                return h.ticketId === ticket.id;
                            })
                        });
                    }
                });
            });

            // Calcular totales GLOBALES
            const totalTickets = allGlobalTickets.length;
            const reassignedTickets = allGlobalTickets.filter(function(ticket) {
                return ticket.isReassigned;
            }).length;
            const notReassignedTickets = totalTickets - reassignedTickets;

            // Actualizar badges con contadores globales
            const allCount = document.getElementById('allTicketsCount');
            const reassignedCount = document.getElementById('reassignedTicketsCount');
            const notReassignedCount = document.getElementById('notReassignedTicketsCount');

            if (allCount) allCount.textContent = totalTickets;
            if (reassignedCount) reassignedCount.textContent = reassignedTickets;
            if (notReassignedCount) notReassignedCount.textContent = notReassignedTickets;
        }

        // Función para renderizar paginador
        function renderPagination(totalItems, totalPages) {
            const paginationList = document.getElementById('paginationList');
            if (!paginationList) return;

            paginationList.innerHTML = '';

            if (totalPages === 0) {
                return;
            }

            // Botón "Previous"
            const prevLi = document.createElement('li');
            prevLi.className = 'paginate_button previous' + (currentPage === 1 ? ' disabled' : '');
            prevLi.id = 'ticketsPagination_previous';
            const prevA = document.createElement('a');
            prevA.href = '#';
            prevA.textContent = 'Previous';
            prevA.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentPage > 1) {
                    currentPage--;
                    renderTickets();
                }
            });
            prevLi.appendChild(prevA);
            paginationList.appendChild(prevLi);

            // Calcular rango de páginas a mostrar
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            // Ajustar si estamos cerca del principio o fin
            if (currentPage <= 3) {
                endPage = Math.min(5, totalPages);
            }
            if (currentPage >= totalPages - 2) {
                startPage = Math.max(1, totalPages - 4);
            }

            // Renderizar números de página
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = 'paginate_button' + (i === currentPage ? ' active' : '');
                const pageA = document.createElement('a');
                pageA.href = '#';
                pageA.textContent = i;
                pageA.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentPage = i;
                    renderTickets();
                });
                pageLi.appendChild(pageA);
                paginationList.appendChild(pageLi);
            }

            // Botón "Next"
            const nextLi = document.createElement('li');
            nextLi.className = 'paginate_button next' + (currentPage === totalPages ? ' disabled' : '');
            nextLi.id = 'ticketsPagination_next';
            const nextA = document.createElement('a');
            nextA.href = '#';
            nextA.textContent = 'Next';
            nextA.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTickets();
                }
            });
            nextLi.appendChild(nextA);
            paginationList.appendChild(nextLi);
        }

        // Función para abrir modal de historial de ticket
        function openTicketHistoryModal(ticketId) {
            const modalBody = document.getElementById('ticketHistoryBody');
            const subtitle = document.getElementById('historyModalSubtitle');
            if (!modalBody || !subtitle) return;

            // Buscar el ticket
            let foundTicket = null;
            let foundOperator = null;
            operatorsData.forEach(function(op) {
                const ticket = op.tickets.find(t => t.id === ticketId);
                if (ticket) {
                    foundTicket = ticket;
                    foundOperator = op;
                }
            });

            if (!foundTicket) {
                modalBody.innerHTML = '<p style="text-align: center; color: #a6adbb;">No se encontró el ticket</p>';
                return;
            }

            // Actualizar subtítulo
            subtitle.textContent = ticketId + ' - ' + foundTicket.name;

            // Obtener historial del ticket
            const history = ticketHistory[ticketId] || [];

            // Generar HTML del timeline
            let html = '<div class="history-timeline">';

            if (history.length === 0) {
                html += '<p style="text-align: center; color: #a6adbb;">No hay historial disponible</p>';
            } else {
                // Ordenar por fecha descendente (más reciente primero)
                const sortedHistory = history.slice().sort(function(a, b) {
                    return b.timestamp - a.timestamp;
                });

                sortedHistory.forEach(function(event) {
                    const timeStr = formatDateTime(event.timestamp);
                    const eventClass = event.type === 'creation' ? 'creation' : (event.type === 'reassignment' ? 'reassignment' : '');

                    html += '<div class="history-timeline-item ' + eventClass + '">';
                    html += '<div class="history-timeline-time">' + timeStr + '</div>';
                    html += '<div class="history-timeline-content">';

                    if (event.type === 'creation') {
                        html += '<strong>Ticket Creado</strong><br>';
                        html += 'Creado en el sistema';
                    } else if (event.type === 'assignment') {
                        html += '<strong>Asignación Inicial</strong><br>';
                        html += 'Asignado a <span class="operator-name">' + event.operatorName + '</span>';
                        if (event.agentName) {
                            html += '<br>Agente: ' + event.agentName;
                        }
                        html += '<br>Por: ' + (event.supervisorName || 'Sistema');
                    } else if (event.type === 'reassignment') {
                        html += '<strong>Reasignación</strong><br>';
                        html += 'De: <span class="operator-name">' + event.fromOperator + '</span><br>';
                        html += 'A: <span class="operator-name">' + event.toOperator + '</span><br>';
                        html += 'Por: <strong>' + event.supervisorName + '</strong>';
                        if (event.reason) {
                            html += '<br><em>' + event.reason + '</em>';
                        }
                    }

                    html += '</div>';
                    html += '</div>';
                });
            }

            html += '</div>';

            modalBody.innerHTML = html;

            // Abrir modal con Bootstrap
            if (window.$ && typeof window.$('#ticketHistoryModal').modal === 'function') {
                window.$('#ticketHistoryModal').modal('show');
            }
        }

        // Función para formatear fecha y hora
        function formatDateTime(date) {
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            return day + '/' + month + '/' + year + ' ' + hours + ':' + minutes;
        }

        // Función para manejar selección/deselección de tickets
        function handleTicketSelection(ticketId, isChecked) {
            if (isChecked) {
                // Agregar a seleccionados si no está
                if (!selectedTickets.includes(ticketId)) {
                    selectedTickets.push(ticketId);
                }
            } else {
                // Remover de seleccionados
                selectedTickets = selectedTickets.filter(function(id) {
                    return id !== ticketId;
                });
            }

            // Actualizar estado del checkbox "Seleccionar todos"
            const selectAllCheckbox = document.getElementById('selectAllTickets');
            const allCheckboxes = document.querySelectorAll('.ticket-checkbox[data-ticket-id]');
            if (selectAllCheckbox && allCheckboxes.length > 0) {
                const allChecked = Array.from(allCheckboxes).every(function(checkbox) {
                    return checkbox.checked;
                });
                selectAllCheckbox.checked = allChecked;
            }

            // Actualizar UI
            updateReassignButton();
            renderTickets();
        }

        // Función para actualizar botón de reasignación
        function updateReassignButton() {
            const btn = document.getElementById('reassignSelectedBtn');
            const countSpan = document.getElementById('selectedTicketsCount');

            if (!btn || !countSpan) return;

            if (selectedTickets.length > 0) {
                btn.style.display = 'block';
                countSpan.textContent = selectedTickets.length;
            } else {
                btn.style.display = 'none';
            }
        }

        // Función para abrir modal de reasignación
        function openReassignModal() {
            if (selectedTickets.length === 0) return;

            // Resetear selección de operador
            selectedOperatorForReassign = null;

            const modalBody = document.getElementById('reassignModalBody');
            const subtitle = document.getElementById('reassignModalSubtitle');
            const confirmBtn = document.getElementById('confirmReassignBtn');

            // Actualizar subtítulo
            subtitle.textContent = 'Seleccione el operador destino para ' + selectedTickets.length + ' ticket(s)';

            // Obtener todos los operadores
            const availableOperators = operatorsData;

            let html = '';

            // Mostrar tickets que se van a reasignar
            html += '<div class="row"><div class="col-lg-12">';
            html += '<div class="panel panel-filled panel-c-accent" style="border-radius: 15px; margin-bottom: 20px;">';
            html += '<div class="panel-heading"><h5>TICKETS A REASIGNAR</h5></div>';
            html += '<div class="panel-body" style="max-height: 200px; overflow-y: auto;">';

            selectedTickets.forEach(function(ticketId) {
                // Buscar el ticket en todos los operadores
                let foundTicket = null;
                let foundOperator = null;
                operatorsData.forEach(function(op) {
                    const ticket = op.tickets.find(t => t.id === ticketId);
                    if (ticket) {
                        foundTicket = ticket;
                        foundOperator = op;
                    }
                });

                if (foundTicket) {
                    html += '<div style="padding: 8px 12px; border-bottom: 1px solid #2a2a2a; display: flex; justify-content: space-between;">';
                    html += '<div><span style="font-weight: 600;">' + foundTicket.id + '</span> <small style="color: #8b5cf6;">(' + foundOperator.name + ')</small></div>';
                    html += '<span style="color: #a6adbb;">' + foundTicket.name + '</span>';
                    html += '</div>';
                }
            });

            html += '</div></div></div></div>';

            // Mostrar dropdown de operadores destino
            html += '<div class="row"><div class="col-lg-12">';
            html += '<div class="panel panel-filled panel-c-accent" style="border-radius: 15px;">';
            html += '<div class="panel-heading"><h5>SELECCIONAR OPERADOR DESTINO</h5></div>';
            html += '<div class="panel-body">';
            html += '<div class="form-group">';
            html += '<label>Operador *</label>';
            html += '<select id="operatorDestinationSelect" class="form-control rounded-input">';
            html += '<option value="">Seleccione un operador</option>';

            availableOperators.forEach(function(operator) {
                const activeTicketsCount = operator.tickets.filter(t => t.status !== 'cerrado').length;
                html += '<option value="' + operator.id + '">' + operator.name + ' (' + activeTicketsCount + ' tickets activos)</option>';
            });

            html += '</select>';
            html += '</div>';
            html += '</div></div></div></div>';

            modalBody.innerHTML = html;

            // Deshabilitar botón de confirmar
            confirmBtn.disabled = true;

            // Event listener para el select
            const selectElement = document.getElementById('operatorDestinationSelect');
            if (selectElement) {
                selectElement.addEventListener('change', function() {
                    const selectedValue = this.value;
                    if (selectedValue) {
                        selectedOperatorForReassign = selectedValue;
                        confirmBtn.disabled = false;
                    } else {
                        selectedOperatorForReassign = null;
                        confirmBtn.disabled = true;
                    }
                });
            }

            // Abrir modal con Bootstrap
            if (window.$ && typeof window.$('#reassignModal').modal === 'function') {
                window.$('#reassignModal').modal('show');
            }
        }

        // Función para confirmar reasignación
        function confirmReassignment() {
            if (!selectedOperatorForReassign || selectedTickets.length === 0) return;

            const toOperator = operatorsData.find(op => op.id === selectedOperatorForReassign);
            if (!toOperator) return;

            let movedCount = 0;

            // Reasignar cada ticket seleccionado
            selectedTickets.forEach(function(ticketId) {
                // Buscar el ticket en todos los operadores
                operatorsData.forEach(function(fromOperator) {
                    const ticketIndex = fromOperator.tickets.findIndex(t => t.id === ticketId);
                    if (ticketIndex !== -1) {
                        // Remover del operador origen
                        const ticket = fromOperator.tickets.splice(ticketIndex, 1)[0];

                        // Agregar al operador destino
                        toOperator.tickets.push(ticket);

                        // Agregar al historial de reasignaciones con supervisor
                        const reassignTime = new Date();
                        reassignmentHistory.push({
                            ticketId: ticket.id,
                            ticketName: ticket.name,
                            priority: ticket.priority,
                            status: ticket.status,
                            fromOperator: fromOperator.name,
                            toOperator: toOperator.name,
                            supervisorName: currentSupervisor,
                            reassignedAt: reassignTime,
                            assignedAgent: ticket.assignedAgent
                        });

                        // Agregar evento al historial del ticket
                        if (!ticketHistory[ticket.id]) {
                            ticketHistory[ticket.id] = [];
                        }
                        ticketHistory[ticket.id].push({
                            type: 'reassignment',
                            timestamp: reassignTime,
                            fromOperator: fromOperator.name,
                            toOperator: toOperator.name,
                            supervisorName: currentSupervisor,
                            reason: fromOperator.endingShift ? 'Turno terminando' : 'Reasignación manual'
                        });

                        // Actualizar contador del operador origen
                        fromOperator.ticketsCount = fromOperator.tickets.filter(t => t.status !== 'cerrado').length;

                        movedCount++;
                    }
                });
            });

            // Actualizar contador del operador destino
            toOperator.ticketsCount = toOperator.tickets.filter(t => t.status !== 'cerrado').length;

            // Limpiar selección
            selectedTickets = [];
            selectedOperatorForReassign = null;

            // Cerrar modal con Bootstrap
            if (window.$ && typeof window.$('#reassignModal').modal === 'function') {
                window.$('#reassignModal').modal('hide');
            }

            // Actualizar vistas
            renderOperators();
            renderTickets();
            updateReassignButton();
            updateReassignedCount();
            updateKPIs(); // Actualizar KPIs después de reasignar

            // Mostrar notificación
            console.log(movedCount + ' ticket(s) reasignado(s) a ' + toOperator.name);
        }

        // Función para actualizar contador de tickets reasignados
        function updateReassignedCount() {
            // Esta función actualiza el badge de tickets reasignados en los filtros
            // Se llama automáticamente cuando se actualiza renderTickets()
        }

        // Función para actualizar KPIs del header
        function updateKPIs() {
            // Calcular total de tickets activos (sin contar cerrados)
            let totalActiveTickets = 0;
            let unassignedTickets = 0;
            let criticalTickets = 0;

            operatorsData.forEach(function(operator) {
                operator.tickets.forEach(function(ticket) {
                    if (ticket.status !== 'cerrado') {
                        totalActiveTickets++;

                        // Contar tickets sin agente asignado
                        if (!ticket.assignedAgent) {
                            unassignedTickets++;
                        }

                        // Contar tickets críticos
                        if (ticket.priority === 'critica' || ticket.priority === 'alta') {
                            criticalTickets++;
                        }
                    }
                });
            });

            // Actualizar DOM
            const kpiTotal = document.getElementById('kpiTotalTickets');
            const kpiUnassigned = document.getElementById('kpiUnassignedTickets');
            const kpiCritical = document.getElementById('kpiCriticalTickets');

            if (kpiTotal) kpiTotal.textContent = totalActiveTickets;
            if (kpiUnassigned) kpiUnassigned.textContent = unassignedTickets;
            if (kpiCritical) kpiCritical.textContent = criticalTickets;
        }

        // Función para manejar búsqueda global
        function handleGlobalSearch(event) {
            const searchTerm = event.target.value.toLowerCase().trim();

            if (searchTerm === '') {
                // Restaurar vista normal
                operatorSearchTerm = '';
                ticketSearchTerm = '';
                renderOperators();
                renderTickets();
                return;
            }

            // Buscar en operadores y tickets simultáneamente
            operatorSearchTerm = searchTerm;
            ticketSearchTerm = searchTerm;

            renderOperators();
            renderTickets();
        }

        // Función para manejar búsqueda de operadores
        function handleOperatorSearch(event) {
            operatorSearchTerm = event.target.value;
            renderOperators();
        }

        // Función para manejar búsqueda de tickets
        function handleTicketSearch(event) {
            ticketSearchTerm = event.target.value;
            currentPage = 1; // Resetear a la primera página
            renderTickets();
        }

        // Función para cambiar filtro de tickets
        function switchTicketFilter(filter) {
            ticketFilter = filter;

            // Actualizar estilos de tabs
            const tabs = document.querySelectorAll('.ticket-filter-tab');
            tabs.forEach(function(tab) {
                const tabFilter = tab.getAttribute('data-filter');
                if (tabFilter === filter) {
                    tab.style.color = '#FFFFFF';
                    tab.style.borderBottomColor = '#f67200';
                    tab.classList.add('active');
                } else {
                    tab.style.color = '#a6adbb';
                    tab.style.borderBottomColor = 'transparent';
                    tab.classList.remove('active');
                }
            });

            // Limpiar selección de tickets al cambiar filtro
            selectedTickets = [];
            updateReassignButton();

            // Resetear página a la primera
            currentPage = 1;

            // Renderizar tickets con nuevo filtro
            renderTickets();
        }

        // Función para abrir modal de reasignación de ticket individual
        function openSingleTicketReassignModal(ticketId) {
            // Limpiar selección anterior y seleccionar solo este ticket
            selectedTickets = [ticketId];
            updateReassignButton();

            // Abrir modal de reasignación
            openReassignModal();
        }

        // Función para cambiar el supervisor actual
        function changeSupervisor() {
            const newSupervisor = prompt('Ingrese el nombre del supervisor en turno:', currentSupervisor);
            if (newSupervisor && newSupervisor.trim() !== '') {
                currentSupervisor = newSupervisor.trim();
                alert('Supervisor actualizado a: ' + currentSupervisor);

                // Actualizar indicador en el header si existe
                updateSupervisorIndicator();
            }
        }

        // Función para actualizar indicador del supervisor en el header
        function updateSupervisorIndicator() {
            const headerTitleSection = document.querySelector('.header-title-section');
            if (headerTitleSection) {
                let supervisorBadge = document.getElementById('supervisorBadge');
                if (!supervisorBadge) {
                    supervisorBadge = document.createElement('div');
                    supervisorBadge.id = 'supervisorBadge';
                    supervisorBadge.style.cssText = 'font-size: 0.8rem; color: #f67200; margin-top: 5px; cursor: pointer; display: inline-flex; align-items: center; gap: 5px;';
                    supervisorBadge.onclick = changeSupervisor;
                    headerTitleSection.appendChild(supervisorBadge);
                }
                supervisorBadge.innerHTML = '<i class="pe-7s-user" aria-hidden="true"></i> Supervisor: <strong>' + currentSupervisor + '</strong> <i class="pe-7s-pen" aria-hidden="true" style="font-size: 0.7rem;"></i>';
            }
        }

        // Inicializar dashboard
        function init() {
            renderOperators();
            renderTickets(); // Renderizar tickets al inicio
            updateReassignedCount();
            updateKPIs(); // Actualizar KPIs del header
            updateSupervisorIndicator(); // Mostrar supervisor actual

            // Event listener para búsqueda global
            const globalSearchInput = document.getElementById('globalSearch');
            if (globalSearchInput) {
                globalSearchInput.addEventListener('input', handleGlobalSearch);
            }

            // Event listener para búsqueda de operadores
            const searchInput = document.getElementById('operatorSearch');
            if (searchInput) {
                searchInput.addEventListener('input', handleOperatorSearch);
            }

            // Event listener para búsqueda de tickets
            const ticketSearchInput = document.getElementById('ticketSearch');
            if (ticketSearchInput) {
                ticketSearchInput.addEventListener('input', handleTicketSearch);
            }

            // Event listener para "Seleccionar todos"
            const selectAllCheckbox = document.getElementById('selectAllTickets');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function(e) {
                    const checkboxes = document.querySelectorAll('.ticket-checkbox[data-ticket-id]');
                    checkboxes.forEach(function(checkbox) {
                        const ticketId = checkbox.getAttribute('data-ticket-id');
                        checkbox.checked = e.target.checked;
                        handleTicketSelection(ticketId, e.target.checked);
                    });
                });
            }

            // Event listeners para filtros de tickets
            const filterTabs = document.querySelectorAll('.ticket-filter-tab');
            filterTabs.forEach(function(tab) {
                tab.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    switchTicketFilter(filter);
                });
            });

            // Event listeners para filtros de operadores
            const operatorFilterTabs = document.querySelectorAll('.operator-filter-tab');
            operatorFilterTabs.forEach(function(tab) {
                tab.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    operatorFilter = filter;

                    // Actualizar estilos de tabs
                    operatorFilterTabs.forEach(function(t) {
                        if (t.getAttribute('data-filter') === filter) {
                            t.classList.add('active');
                            t.style.color = '#FFFFFF';
                            t.style.borderBottomColor = '#f67200';
                        } else {
                            t.classList.remove('active');
                            t.style.color = '#a6adbb';
                            t.style.borderBottomColor = 'transparent';
                        }
                    });

                    renderOperators();
                });
            });

            // Event delegation para checkboxes de tickets (una sola vez)
            const ticketsTableBody = document.getElementById('ticketsTableBody');
            if (ticketsTableBody) {
                ticketsTableBody.addEventListener('change', function(e) {
                    if (e.target.classList.contains('ticket-checkbox') && e.target.hasAttribute('data-ticket-id')) {
                        const ticketId = e.target.getAttribute('data-ticket-id');
                        handleTicketSelection(ticketId, e.target.checked);
                    }
                });

                // Event delegation para botones de reasignación y historial
                ticketsTableBody.addEventListener('click', function(e) {
                    // Botón de reasignación
                    if (e.target.classList.contains('reassign-btn') || e.target.closest('.reassign-btn')) {
                        const btn = e.target.classList.contains('reassign-btn') ? e.target : e.target.closest('.reassign-btn');
                        const ticketId = btn.getAttribute('data-ticket-id');
                        if (ticketId) {
                            openSingleTicketReassignModal(ticketId);
                        }
                    }
                    // Botón de historial
                    else if (e.target.classList.contains('history-btn') || e.target.closest('.history-btn')) {
                        const btn = e.target.classList.contains('history-btn') ? e.target : e.target.closest('.history-btn');
                        const ticketId = btn.getAttribute('data-ticket-id');
                        if (ticketId) {
                            openTicketHistoryModal(ticketId);
                        }
                    }
                });
            }

            // Actualizar tiempos cada minuto
            setInterval(function() {
                renderTickets();
            }, 60000); // 60 segundos
        }

        // Ejecutar al cargar
        init();

        // Exponer funciones globalmente si es necesario
        window.supervisorDashboard = {
            refresh: function() {
                renderOperators();
                renderTickets();
            },
            updateData: function(newData) {
                operatorsData = newData;
                renderOperators();
                renderTickets();
            },
            openReassignModal: openReassignModal,
            confirmReassignment: confirmReassignment,
            closeOperatorTab: closeOperatorTab,
            openSingleTicketReassignModal: openSingleTicketReassignModal,
            openTicketHistoryModal: openTicketHistoryModal,
            changeSupervisor: changeSupervisor,
            getReassignmentHistory: function() {
                return reassignmentHistory;
            },
            getCurrentSupervisor: function() {
                return currentSupervisor;
            },
            getTicketHistory: function(ticketId) {
                return ticketHistory[ticketId] || [];
            }
        };
    })();
    </script>
</div>
